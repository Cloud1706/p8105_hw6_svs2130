Homework 6
================
Harsha Senapathi
11/21/2019

``` r
child_data = read_csv("./data/birthweight.csv") %>% 
  janitor::clean_names() %>% 
  mutate(babysex = as.factor(babysex))%>% 
  mutate(frace = as.factor(frace))%>% 
  mutate(mrace = as.factor(mrace))%>% 
  mutate(malform = as.factor(malform)) %>% 
  mutate(parity = as.factor(parity)) %>% 
  select(-pnumlbw, -pnumsga) %>% 
  select(bwt, babysex, everything())
```

    ## Parsed with column specification:
    ## cols(
    ##   .default = col_double()
    ## )

    ## See spec(...) for full column specifications.

# Using backward elimiantion to look for preditors

``` r
fit_mlr_child_bwt = lm(bwt ~ ., data = child_data)

backward_elim_child_bwt_predictors =
  step(fit_mlr_child_bwt, direction = "backward") %>% 
  broom::tidy() %>% 
  knitr::kable()
```

    ## Start:  AIC=48721.15
    ## bwt ~ babysex + bhead + blength + delwt + fincome + frace + gaweeks + 
    ##     malform + menarche + mheight + momage + mrace + parity + 
    ##     ppbmi + ppwt + smoken + wtgain
    ## 
    ## 
    ## Step:  AIC=48721.15
    ## bwt ~ babysex + bhead + blength + delwt + fincome + frace + gaweeks + 
    ##     malform + menarche + mheight + momage + mrace + parity + 
    ##     ppbmi + ppwt + smoken
    ## 
    ##            Df Sum of Sq       RSS   AIC
    ## - frace     4    124327 320798404 48715
    ## - malform   1      1419 320675497 48719
    ## - ppbmi     1      6404 320680482 48719
    ## - momage    1     29190 320703267 48720
    ## - mheight   1     66897 320740975 48720
    ## - menarche  1    114790 320788868 48721
    ## - ppwt      1    131451 320805529 48721
    ## <none>                  320674078 48721
    ## - parity    3    463844 321137922 48721
    ## - fincome   1    195737 320869815 48722
    ## - mrace     3    868995 321543073 48727
    ## - babysex   1    850077 321524155 48731
    ## - gaweeks   1   4591143 325265221 48781
    ## - smoken    1   5084657 325758735 48787
    ## - delwt     1   8017759 328691837 48826
    ## - blength   1 102100505 422774583 49919
    ## - bhead     1 106411593 427085671 49963
    ## 
    ## Step:  AIC=48714.83
    ## bwt ~ babysex + bhead + blength + delwt + fincome + gaweeks + 
    ##     malform + menarche + mheight + momage + mrace + parity + 
    ##     ppbmi + ppwt + smoken
    ## 
    ##            Df Sum of Sq       RSS   AIC
    ## - malform   1      1447 320799852 48713
    ## - ppbmi     1      7035 320805440 48713
    ## - momage    1     28905 320827309 48713
    ## - mheight   1     69512 320867917 48714
    ## - menarche  1    118883 320917287 48714
    ## - ppwt      1    134283 320932687 48715
    ## <none>                  320798404 48715
    ## - parity    3    464986 321263390 48715
    ## - fincome   1    196711 320995115 48715
    ## - babysex   1    848422 321646827 48724
    ## - gaweeks   1   4604454 325402858 48775
    ## - smoken    1   5044590 325842995 48781
    ## - delwt     1   8021925 328820330 48820
    ## - mrace     3  13561750 334360154 48889
    ## - blength   1 102045932 422844337 49912
    ## - bhead     1 106539197 427337601 49958
    ## 
    ## Step:  AIC=48712.85
    ## bwt ~ babysex + bhead + blength + delwt + fincome + gaweeks + 
    ##     menarche + mheight + momage + mrace + parity + ppbmi + ppwt + 
    ##     smoken
    ## 
    ##            Df Sum of Sq       RSS   AIC
    ## - ppbmi     1      6988 320806840 48711
    ## - momage    1     29189 320829041 48711
    ## - mheight   1     69330 320869182 48712
    ## - menarche  1    119206 320919058 48712
    ## - ppwt      1    134215 320934067 48713
    ## <none>                  320799852 48713
    ## - parity    3    464781 321264633 48713
    ## - fincome   1    196086 320995938 48714
    ## - babysex   1    847570 321647422 48722
    ## - gaweeks   1   4603253 325403105 48773
    ## - smoken    1   5043396 325843248 48779
    ## - delwt     1   8037921 328837773 48818
    ## - mrace     3  13574667 334374519 48887
    ## - blength   1 102059467 422859319 49910
    ## - bhead     1 106551539 427351391 49956
    ## 
    ## Step:  AIC=48710.95
    ## bwt ~ babysex + bhead + blength + delwt + fincome + gaweeks + 
    ##     menarche + mheight + momage + mrace + parity + ppwt + smoken
    ## 
    ##            Df Sum of Sq       RSS   AIC
    ## - momage    1     29731 320836571 48709
    ## - menarche  1    120843 320927683 48711
    ## <none>                  320806840 48711
    ## - parity    3    463224 321270064 48711
    ## - fincome   1    197536 321004376 48712
    ## - babysex   1    846289 321653129 48720
    ## - mheight   1   1074748 321881588 48723
    ## - ppwt      1   2936089 323742929 48749
    ## - gaweeks   1   4600576 325407416 48771
    ## - smoken    1   5047513 325854353 48777
    ## - delwt     1   8033739 328840579 48816
    ## - mrace     3  13572731 334379571 48885
    ## - blength   1 102068715 422875555 49908
    ## - bhead     1 106698523 427505363 49956
    ## 
    ## Step:  AIC=48709.35
    ## bwt ~ babysex + bhead + blength + delwt + fincome + gaweeks + 
    ##     menarche + mheight + mrace + parity + ppwt + smoken
    ## 
    ##            Df Sum of Sq       RSS   AIC
    ## - menarche  1    102957 320939527 48709
    ## <none>                  320836571 48709
    ## - parity    3    481153 321317724 48710
    ## - fincome   1    243892 321080463 48711
    ## - babysex   1    837411 321673982 48719
    ## - mheight   1   1072930 321909500 48722
    ## - ppwt      1   2914802 323751372 48747
    ## - gaweeks   1   4653816 325490387 48770
    ## - smoken    1   5052936 325889507 48775
    ## - delwt     1   8008803 328845373 48814
    ## - mrace     3  14689757 335526327 48898
    ## - blength   1 102040170 422876740 49906
    ## - bhead     1 106743610 427580181 49954
    ## 
    ## Step:  AIC=48708.74
    ## bwt ~ babysex + bhead + blength + delwt + fincome + gaweeks + 
    ##     mheight + mrace + parity + ppwt + smoken
    ## 
    ##           Df Sum of Sq       RSS   AIC
    ## <none>                 320939527 48709
    ## - parity   3    469654 321409181 48709
    ## - fincome  1    248706 321188233 48710
    ## - babysex  1    842474 321782001 48718
    ## - mheight  1   1007447 321946974 48720
    ## - ppwt     1   2907935 323847462 48746
    ## - gaweeks  1   4640497 325580024 48769
    ## - smoken   1   5081920 326021447 48775
    ## - delwt    1   8146778 329086305 48816
    ## - mrace    3  14705208 335644735 48897
    ## - blength  1 102238364 423177891 49907
    ## - bhead    1 106658259 427597786 49953

``` r
# stepwise regression using backward elimination

new_fit_mlr_child_bwt = 
  lm(bwt ~ parity + fincome + babysex + mheight + ppwt + gaweeks + smoken + delwt + mrace + blength + bhead, data = child_data)

new_fit_mlr_child_bwt %>% 
  broom::tidy()
```

    ## # A tibble: 16 x 5
    ##    term         estimate std.error statistic   p.value
    ##    <chr>           <dbl>     <dbl>     <dbl>     <dbl>
    ##  1 (Intercept) -6098.      138.      -44.3   0.       
    ##  2 parity1       298.      273.        1.09  2.74e-  1
    ##  3 parity3       210.      273.        0.772 4.40e-  1
    ##  4 parity6       583.      274.        2.13  3.32e-  2
    ##  5 fincome         0.320     0.175     1.83  6.72e-  2
    ##  6 babysex2       28.5       8.46      3.37  7.59e-  4
    ##  7 mheight         6.58      1.79      3.69  2.31e-  4
    ##  8 ppwt           -2.68      0.427    -6.26  4.20e- 10
    ##  9 gaweeks        11.6       1.46      7.91  3.27e- 15
    ## 10 smoken         -4.85      0.586    -8.28  1.67e- 16
    ## 11 delwt           4.11      0.392    10.5   2.16e- 25
    ## 12 mrace2       -139.        9.91    -14.0   1.08e- 43
    ## 13 mrace3        -74.9      42.3      -1.77  7.68e-  2
    ## 14 mrace4       -101.       19.3      -5.21  1.97e-  7
    ## 15 blength        75.0       2.02     37.1   4.13e-262
    ## 16 bhead         131.        3.45     37.9   7.06e-272

``` r
child_data %>% 
  add_predictions(new_fit_mlr_child_bwt) %>% 
  add_residuals(new_fit_mlr_child_bwt) %>% 
  ggplot(aes(x = pred, y = resid)) +
  geom_point(alpha = 0.4) +
  labs(
    title = "Residuals against fitted values for the new model",
    x = "Fitted Values", 
    y = "Residuals"
  )
```

![](hw6_svs2130_files/figure-gfm/p1_model_prediction_vs_residuals-1.png)<!-- -->
\#\#\# Comparison of the above model with the following two models:

MLR\_1 : One using length at birth and gestational age as predictors
(main effects only)

MLR\_2 : One using head circumference, length, sex, and all interactions
(including the three-way interaction) between these

In the following code chunk, cross validation is carried out followed by
a plot to compare the spread of *root mean squares* in the three models.

``` r
set.seed(1)

fit_mlr_1 = lm(bwt ~ blength + gaweeks, data = child_data)
fit_mlr_2 = lm(bwt ~ bhead*blength*babysex, data = child_data) 
# multiple regression with interaction

cv_df = 
  crossv_mc(child_data, n = 100) %>% 
  mutate(train = map(train, as_tibble),
         test = map(test, as_tibble)) 

cv_df = cv_df %>% 
  mutate(proposed_mlr  = map(train, ~lm(bwt ~ parity + fincome + babysex + mheight + ppwt + gaweeks + smoken + delwt + mrace + blength + bhead, data = child_data)),
         mlr_1 = map(train, ~lm(bwt ~ blength + gaweeks, data = child_data)),
         mlr_2 = map(train, ~lm(bwt ~ bhead*blength*babysex, data = child_data))
  ) %>% 
  mutate(rmse_proposed  = map2_dbl(proposed_mlr,  test, ~rmse(model = .x, data = .y)),
         rmse_mlr_1 = map2_dbl(mlr_1, test, ~rmse(model = .x, data = .y)),
         rmse_mlr_2 = map2_dbl(mlr_2, test, ~rmse(model = .x, data = .y))
  )

cv_df %>% 
  select(starts_with("rmse")) %>% 
  pivot_longer(
    everything(), 
    names_to = "model",
    values_to = "rmse", 
    names_prefix = "rmse_") %>%  
  mutate(model =   fct_inorder(model)) %>% 
  ggplot(aes(x = model, y = rmse)) + geom_violin() + 
  labs(
    title = "Comparison of the proposed model with two alternative models",
    x = "Models", 
    y = "Root mean squares"
  )
```

![](hw6_svs2130_files/figure-gfm/p1_model_comparisons-1.png)<!-- -->
